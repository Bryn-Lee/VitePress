# 账户中心系统版本

| 模块     | 升级前版本号    | 升级后版本号      | 备注 |
| -------- | :-------------- | ----------------- | ---- |
| 账户中心 | unicenter1.0.18 | unicenter1.0.18-1 |      |


# 升级说明

## 1.  升级时间

当天开户部门工作结束。

# 升级步骤

## 2.  停止账户中心应用服务

1)    执行/unicenter/unicenter_stop.sh 停止所有的进程。执行ps -ef|grep java检查是否存在遗留进程。
```bash
[root@localhost /]# cd /
[root@localhost /]# cd unicenter/
[root@localhost unicenter]# ./unicenter_stop.sh
[root@localhost unicenter]# ps -ef|grep java
```

## 3.  备份应用程序

1)    登录应用程序服务器，执行/unicenter/backup/backup.sh备份所有程序包。
```shell
[root@localhost /]# cd /
[root@localhost /]# cd unicenter/backup/
[root@localhost backup]# ./backup.sh
```
## 4.  升级数据库

1)   执行/ora_backup/unicenter_expdp.sh 备份数据库；备份成功会在/ora_backup中产生一个日期文件夹，里面存在一个dmp数据文件，文件不存在或文件过小则备份不成功。
```shell
[oracle@localhost ~]$ cd /
[oracle@localhost /]$ cd ora_backup
[oracle@localhost ora_backup]$ ./unicenter_expdp.sh
```
2)   将 <span style="background:#fff88f"><font color="#ff0000">数据库</font></span> 中的所有文件上传至/ora_update/update下

3)   oracle用户执行/ora_update/unicenter_database_update.sh
```shell
[oracle@localhost /]$ cd /
[oracle@localhost /]$ cd ora_update/
[oracle@localhost ora_update]$ ./unicenter_database_update.sh
```
## 5.  升级应用程序

1)   登录应用程序服务器， 将 <span style="background:#fff88f"><font color="#ff0000"><font color="#ff0000">tomcat文件夹</font></font></span>上传至/unicenter/update/中
2)   将 <span style="background:#fff88f"><font color="#ff0000">unicenter-sync文件夹</font></span>上传至/unicenter/update/中
4)   执行/unicenter/update/update.sh
```shell
[root@localhost /]# cd unicenter/update/
[root@localhost update]# ./update.sh
```


## 6.  启动所有程序

执行/unicenter/unicenter_start.sh 启动所有的程序，升级完成。执行ps -ef|grep java检查进程是否正常启动。
```shell
[root@localhost /]# cd /
[root@localhost /]# cd unicenter/
[root@localhost unicenter]# ./unicenter_start.sh
[root@localhost unicenter]# ps -ef|grep java
```

## 7. 添加变量配置

1. 前往 管理工具>变量配置 菜单，变量目录选择sys下session，点击上方功能性按钮”添加变量“，以下是参考修改值。

   

   名称：passwordVerify

   变量值：true

   类型：bool

   说明：  用户管理界面，密码设置时是否校验密码强度。默认：false。不校验

   

   名称：pswRule

   变量值：```^(?![A-Za-z]+$)(?!\d+$)(?![\W_]+$)\S{8,16}$```

   类型：string

   说明：  密码的正则

   

   名称：pswRuleMsg

   变量值：密码至少要由包括大小写字母、数字、标点符号的其中两项，共计8-16位编码组成！  

   类型：string

   说明：  密码的正则表达描述

![](https://gitee.com/leonblack/ImgURL/raw/master/image/2024822/u8kn6tfh6g1724293483494.png)



## 8.其他升级（根据实际情况选择升级，无强制要求）

如果同步程序需要配置为https访问，sync程序可配置 ssl

1. 编辑/unicenter/unicenter-sync/application.yml，新增ssl配置项，将unicenter-sync 文件夹中默认提供的证书文件 unicenter.keystore 放入/unicenter/unicenter-sync/ 中，也可可根据自身情况使用证书。修改完成后重启 sync 程序生效。 

   ```
   server:
     port: 8102
     servlet:
       context-path: /unicenter
     ssl:
       #证书路径 按证书的实际绝对路径配置
       key-store: /unicenter/unicenter-sync/unicenter.keystore
       #key store的类型
       key-store-type: PKCS12
       #访问key store的密码
       key-store-password: unicenter
       #store中key的别名
       key-alias: unicenter
   spring:
     profiles:
       active: prod
   
   ```

2. 修改同步程序配置

   前往 账户管理>系统配置 菜单，修改 柜台配置目录中的同步程序地址http为 https

![](https://gitee.com/leonblack/ImgURL/raw/master/image/2024913/67o8vuo4uf1726196001122.png)
