# 账户中心系统版本

| 模块 | 升级前版本号 | 升级后版本号 |
| ------ | :----- | ------ |
| 账户中心 | unicenter1.0.17 | unicenter1.0.17-1 |


# 升级说明

## 1.  升级时间

当天开户部门工作结束。

# 升级步骤

## 2.  停止账户中心应用服务

1)    执行/unicenter/unicenter_stop.sh 停止所有的进程。执行ps -ef|grep java检查是否存在遗留进程。
```bash
[root@localhost /]# cd /
[root@localhost /]# cd unicenter/
[root@localhost unicenter]# ./unicenter_stop.sh
[root@localhost unicenter]# ps -ef|grep java
```

## 3.  备份应用程序

1)    登录应用程序服务器，执行/unicenter/backup/backup.sh备份所有程序包。
```shell
[root@localhost /]# cd /
[root@localhost /]# cd unicenter/backup/
[root@localhost backup]# ./backup.sh
```
## 4.  升级数据库

1)   执行/ora_backup/unicenter_expdp.sh 备份数据库；备份成功会在/ora_backup中产生一个日期文件夹，里面存在一个dmp数据文件，文件不存在或文件过小则备份不成功。
```shell
[oracle@localhost ~]$ cd /
[oracle@localhost /]$ cd ora_backup
[oracle@localhost ora_backup]$ ./unicenter_expdp.sh
```
2. 将 <span style="background:#fff88f"><font color="#ff0000">数据库</font></span> 中的所有文件上传至/ora_update/update下

3. oracle用户执行/ora_update/unicenter_database_update.sh

```shell
[oracle@localhost /]$ cd /
[oracle@localhost /]$ cd ora_update/
[oracle@localhost ora_update]$ ./unicenter_database_update.sh
```
## 5.  更新脚本

1)    将 <span style="background:#fff88f"><font color="#ff0000">脚本/应用服务</font></span> 中 update.sh 上传至/unicenter/update/中，存在则替换。
1)    将 <span style="background:#fff88f"><font color="#ff0000">report</font></span> 中 report.sh 上传至/unicenter/report/中替换。
4)    脚本赋予执行权限

## 6.  升级应用程序

1)   登录应用程序服务器， 将 <span style="background:#fff88f"><font color="#ff0000"><font color="#ff0000">tomcat文件夹</font></font></span>上传至/unicenter/update/中
2)   将 <span style="background:#fff88f"><font color="#ff0000">unicenter-sync文件夹</font></span>上传至/unicenter/update/中
4)   执行/unicenter/update/update.sh
```shell
[root@localhost /]# cd unicenter/update/
[root@localhost update]# ./update.sh
```

## 7.  修改配置文件

  1)   编辑/unicenter/tomcat/webapps/ks/wb/system/var.json ，在 "limitPassword" 下方插入"pswRule"，"pswRuleMsg"，"passwordExpireRemindBeforeDays"部分，在 "CTP" 下方插入"custom"，"whitesFilters" 部份，保存。注意对比差异，不要缺少任何符号。

```json
     "limitPassword": [
       true,
       "是否启用限制密码登录5次功能。",
       {"type": "bool"}
     ],
     "pswRule": [
       "^(?![A-Za-z]+$)(?!\\d+$)(?![\\W_]+$)\\S{8,16}$",
       "密码的正则表达描述",
       {"type": "string"}
     ],
     "pswRuleMsg": [
       "密码至少要由包括大小写字母、数字、标点符号的其中两项,共计8-16位编码组成",
       "密码的正则表达描述",
       {"type": "string"}
     ],
     "passwordExpireRemindBeforeDays": [
       30,
       "密码过期前几天提醒, 默认-1表示忽略",
       {"type": "int"}
     ]
   },
   "locale": {
     "urlEncoding": [
       "",
       "应用服务器对URL使用的编码，可能值为iso-8859-1或utf-8。",
       {"type": "string"}
     ],
 
 .......
 
    "CTP": {
     "fileUploadPath": [
       "D:\\file_manage",
       "档案管理文件目录",
       {"type": "string"}
     ],
     "fileType": [
       "{11:152,12:132,13:133,18:154,19:153}",
       "期货云开户档案类型管理（：前表示接口提供类型）",
       {"type": "string"}
     ]
   },
   "custom": {
     "logSensitive2Table": [
       false,
       "日志脱敏字段的明文是否要入库",
       {"type": "bool"}
     ],
     "logSensitiveFileds": [
       "PASSWORD,RE_PASSWORD,CERT_NO",
       "日志脱敏字段",
       {"type": "string"}
     ]
   },
   "whitesFilters": {"presistanceVisitorTraceFilter": {
     "xwlBlackList": [
       "",
       "不记录的xwl交易日志，如填写admin/dept则admin/dept下的所有xwl不记录交易日志,也可填写具体的xwl路径。可填写多个逗号分割。",
       {"type": "string"}
     ],
     "xwlWhiteList": [
       "",
       "只记录指定的xwl交易日志。如填写admin/dept则会只记录admin/dept下的所有xwl交易日志，也可填写具体的xwl路径。可填写多个逗号分割。为空表示记录所有",
       {"type": "string"}
     ]
   }}
 }}
 
```
## 7.  启动所有程序

1. 执行/unicenter/unicenter_start.sh 启动所有的程序，升级完成。执行ps -ef|grep java检查进程是否正常启动。

```shell
[root@localhost /]# cd /
[root@localhost /]# cd unicenter/
[root@localhost unicenter]# ./unicenter_start.sh
[root@localhost unicenter]# ps -ef|grep java
```

## 8.  修改配置

1. 前往 管理工具>变量配置 菜单，变量目录选择 session，对右侧变量列表修改，以下是参考修改值。

   | 变量名称                       | 推荐值 | 说明                               |
   | ------------------------------ | ------ | ---------------------------------- |
   | passwordExpired                | true   | 是否启用密码过期修改功能           |
   | setReviseDate                  | 90     | 自定义设置重新设置密码的天数       |
   | passwordExpireRemindBeforeDays | 30     | 密码过期前几天提醒, 默认-1表示忽略 |

   

   

   
